--- /var/ida/nextcloud-new/lib/public/AppFramework/Http/JSONResponse.php	2024-11-05 08:30:09.573706781 +0000
+++ /var/ida/nextcloud-old/lib/public/AppFramework/Http/JSONResponse.php.original	2024-02-20 10:11:39.333443457 +0000
@@ -1,10 +1,36 @@
 <?php
+/**
+ * @copyright Copyright (c) 2016, ownCloud, Inc.
+ *
+ * @author Bernhard Posselt <dev@bernhard-posselt.com>
+ * @author Christoph Wurst <christoph@winzerhof-wurst.at>
+ * @author Lukas Reschke <lukas@statuscode.ch>
+ * @author Morris Jobke <hey@morrisjobke.de>
+ * @author Roeland Jago Douma <roeland@famdouma.nl>
+ * @author Thomas MÃ¼ller <thomas.mueller@tmit.eu>
+ * @author Thomas Tanghus <thomas@tanghus.net>
+ *
+ * @license AGPL-3.0
+ *
+ * This code is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License, version 3,
+ * as published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License, version 3,
+ * along with this program. If not, see <http://www.gnu.org/licenses/>
+ *
+ */
 
 /**
- * SPDX-FileCopyrightText: 2016-2024 Nextcloud GmbH and Nextcloud contributors
- * SPDX-FileCopyrightText: 2016 ownCloud, Inc.
- * SPDX-License-Identifier: AGPL-3.0-only
+ * Public interface of ownCloud for apps to use.
+ * AppFramework\HTTP\JSONResponse class
  */
+
 namespace OCP\AppFramework\Http;
 
 use OCP\AppFramework\Http;
@@ -12,43 +38,27 @@
 /**
  * A renderer for JSON calls
  * @since 6.0.0
- * @template S of int
- * @template-covariant T of array|object|\stdClass|\JsonSerializable
- * @template H of array<string, mixed>
- * @template-extends Response<int, array<string, mixed>>
  */
 class JSONResponse extends Response {
+
 	/**
 	 * response data
-	 * @var T
+	 * @var array|object
 	 */
 	protected $data;
-	/**
-	 * Additional `json_encode` flags
-	 * @var int
-	 */
-	protected $encodeFlags;
 
 
 	/**
 	 * constructor of JSONResponse
-	 * @param T $data the object or array that should be transformed
-	 * @param S $statusCode the Http status code, defaults to 200
-	 * @param H $headers
-	 * @param int $encodeFlags Additional `json_encode` flags
+	 * @param array|object $data the object or array that should be transformed
+	 * @param int $statusCode the Http status code, defaults to 200
 	 * @since 6.0.0
-	 * @since 30.0.0 Added `$encodeFlags` param
 	 */
-	public function __construct(
-		mixed $data = [],
-		int $statusCode = Http::STATUS_OK,
-		array $headers = [],
-		int $encodeFlags = 0,
-	) {
-		parent::__construct($statusCode, $headers);
+	public function __construct($data = [], $statusCode = Http::STATUS_OK) {
+		parent::__construct();
 
 		$this->data = $data;
-		$this->encodeFlags = $encodeFlags;
+		$this->setStatus($statusCode);
 		$this->addHeader('Content-Type', 'application/json; charset=utf-8');
 	}
 
@@ -60,13 +70,18 @@
 	 * @throws \Exception If data could not get encoded
 	 */
 	public function render() {
-		return json_encode($this->data, JSON_HEX_TAG | JSON_THROW_ON_ERROR | $this->encodeFlags, 2048);
+		$response = json_encode($this->data, JSON_HEX_TAG);
+		if ($response === false) {
+			throw new \Exception(sprintf('Could not json_encode due to invalid ' .
+				'non UTF-8 characters in the array: %s', var_export($this->data, true)));
+		}
+
+		return $response;
 	}
 
 	/**
 	 * Sets values in the data json array
-	 * @psalm-suppress InvalidTemplateParam
-	 * @param T $data an array or object which will be transformed
+	 * @param array|object $data an array or object which will be transformed
 	 *                             to JSON
 	 * @return JSONResponse Reference to this object
 	 * @since 6.0.0 - return value was added in 7.0.0
@@ -79,7 +94,8 @@
 
 
 	/**
-	 * @return T the data
+	 * Used to get the set parameters
+	 * @return array the data
 	 * @since 6.0.0
 	 */
 	public function getData() {
